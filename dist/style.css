@import url('https://fonts.googleapis.com/css2?family=Manrope');

:root {
  font-size: clamp(1.5rem, 2vw + 1rem, 2.5rem);
  --clr-bg: #020617;
  --clr-text: #fff;
  --clr-primary: #fff;
  
  --hover-intensity: 10rem;
  --hover-smoothness: 70ms; 
  --fall-smoothness: 250ms;
  --perspective: 2000px;
}

body {
  height: 100svh;
  display: grid;
  place-items: center;
  font-family: "Manrope", sans-serif;
  background: var(--clr-bg);
  color: var(--clr-text);
  overflow: hidden;
  padding: 2em;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

nav {  
  /* region */
  --r: calc(var(--max-z) * (var(--p) - 1) + var(--z)); 
  
  /* normalized [0-1]*/
  --r-n: calc(
    (var(--r) - 1) / (var(--max-z) * var(--max-p) - 1)
  );
  
  block-size: min(8rem, 100%);
  inline-size: min(30rem, 100%);

  display: flex;
  align-items: flex-end;
  position: relative;
  
  perspective: var(--perspective);
  transform-style: preserve-3d;
  
  --dir: 0deg;
  
  @media (max-width: 40rem) {
    writing-mode: sideways-rl;
    --dir: -90deg;
  }
}



a {  
  flex: 1;
  block-size: 100%;
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  color: inherit;
  font-size: 1rem;
  cursor: pointer;
  transform-style: preserve-3d;
  
  --ts: calc(
    var(--hover-smoothness) * var(--falloff) +
    var(--fall-smoothness) * (1 - var(--falloff))
  );
  
  --fs: calc(
    .1s * var(--falloff,0) +
    .8s * (1 - var(--falloff,0))
  );
  
  transition: 
    scale var(--op, .15s),
    filter var(--fs),
    transform var(--ts, var(--fall-smoothness)),
    flex .3s
  ;
  
/*   &:active {
    scale: 1.05;
    --op: .05s;
  } */
}


a {
  --p-n: calc(var(--i) / (var(--max-p) - 1));
  --diff: calc(var(--p-n) - var(--r-n));  
  --u: calc(abs(var(--diff)) / var(--w)); 
    
/*   
  --n: 2; --w: .3;
  --falloff: pow(clamp(calc(1 - var(--u)), 0, 1), var(--n)); 
*/
  
  --w: .4;
  --falloff: clamp(calc(0.5 * (1 + cos(min(var(--u), 1) * 180deg))), 0, 1);
  
/*   
  --n: 4; --w: .2; 
  --falloff: calc(1 / (1 + pow(var(--u), var(--n)))); 
 */
  
  --tilt: calc(clamp(-1,var(--diff) * 5, 1) * var(--falloff) * 70deg);
  
  transform: 
    translateZ(calc(var(--falloff) * var(--hover-intensity)))
    rotateY(calc(var(--tilt) * cos(var(--dir))))
    rotateX(calc(var(--tilt) * sin(var(--dir))))
  ;
  
  filter: 
    brightness(max(.5, var(--falloff, 0) * 1.2))
    saturate(var(--falloff, 0))
  ;
}

.img {
  background: var(--img);
  background-color: #fff3;
  background-size: cover;
  background-position: center;
  width: 100%;
  height: 100%;
  margin-inline: 0.1em;
  position: relative;
  
/*   &::after {
    content: '';
    inset: 0;
    position: absolute;
    backdrop-filter: blur(11px);
  } */
}

.text-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  font-size: 1.2rem;
  font-weight: 600;
  text-align: center;
  opacity: 0;
  transform: scale(0.8);
  transition: all 0.3s ease;
  pointer-events: none;
  z-index: 10;
  backdrop-filter: blur(4px);
  border-radius: 0.2em;
}

/* Show text overlay when clicked */
a.clicked .text-overlay {
  opacity: 1;
  transform: scale(1);
}

/* Alternative: show on hover for testing */
a:hover .text-overlay {
  opacity: 0.3;
  transform: scale(0.9);
}

.hover-zone {
  position: absolute;
  inset: 0;
  inset-inline: -3px;
  display: flex;
  z-index: 999;
}

.hover-zone > i {
  flex: 1;
  transition: .3s;
}

/* update 09/21/25: added click bud */

.hover-zone::after {
  position: absolute;
  inset: 0;
}

.hover-zone:active::after,
.hover-zone:hover:not(:has(> i:hover))::after,
a:focus-visible .hover-zone::after {
  content: '';
  pointer-events: all;
  --o: 1;
}

nav:has(.hover-zone:hover):not(:has(i:hover)), 
nav:has(a:focus-visible) {
  --z: calc((var(--max-z) + 1) / 2);
}

nav:has(.hover-zone:hover):not(:has(i:hover)) a:hover,
nav:has(.hover-zone:hover):not(:has(i:hover)) a:focus-visible,
nav:has(a:focus-visible) a:hover,
nav:has(a:focus-visible) a:focus-visible {
  flex: 4;
}
/* --- */

/* dbg check */
label {
  position: fixed;
  bottom: 1em;
/*   right: 0; */
  cursor: pointer;
  user-select: none;
  transition: var(--h, .3s);
  opacity: .3;
  display: inline-flex;
}

label:hover {
  opacity: .5; 
  letter-spacing: 5px; 
  --h: .1s;
}

label::after {
  content: 'ing..';
  max-width: var(--ing, 0px);
  overflow: hidden;
  display: inherit;
  transition: .3s;
}

label:has(> :focus-visible) {
  outline: solid 1px currentColor;
}

label:has(> :checked) {
  opacity: 1;
  --ing: max-content;
}

#dbg {
/*   display: none; */
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

/* debugging */
nav::before {
  counter-set: 
    pic var(--p) 
    zone var(--z) 
    region var(--r)
    region-norm calc(var(--r-n) * 100)
  ;
  tab-size: 12;
  content: 
    'debug:'
    "\a r: " counter(region)
        "\9(" counter(region-norm) "%)"
    "\ap: " counter(pic) 
    "\9z: " counter(zone)
  ;
  white-space: pre-wrap;
  writing-mode: horizontal-tb;
  position: fixed;
  inset-block-end: -1em;
  transform: translateY(100%);
  opacity: 0;
  font-size: .5em;
  transition: opacity .3s;
  pointer-events: none;
}

/* item debug */
.img::before {
  counter-set: 
    item var(--i) 
    falloff calc(var(--falloff, 0) * 100)
    diff calc(var(--diff, 0) * 100)
  ;

  content: 
    "\a i: " counter(item)
    "\a d:" counter(diff)
    "\a f: " counter(falloff) "%"
  ;
  font-size: .5em;
  white-space: pre;
  position: fixed;
  inset-block-end: 100%;
  opacity: .0;
  transition: .3s;
  transition-delay: calc(var(--i) * 25ms);
  pointer-events: none;
  block-size: 0px;
  overflow: hidden;
}

.hover-zone::after{
  font-size: 0.5em;
  text-align: center;
  align-content: center;
  background: #0005;
  transition: opacity .5s, letter-spacing var(--h, .3s);
  opacity: 0;
  overflow: hidden;
  writing-mode: sideways-lr;
  
  /* when debugging, uses p-e*/
  pointer-events: none;
}

.hover-zone:active::after {
  letter-spacing: 5px;
  --h: 50ms;
}

body:has(#dbg:checked) nav::before,
body:has(#dbg:checked) .img::before {
  opacity: .3;
}

body:has(#dbg:checked) .img::before {
  block-size: auto;
}

body:has(#dbg:checked) i:nth-child(odd) {
  background: #0003;
}

body:has(#dbg:checked) i:hover {
  background: #fff5; 
  transition: 0ms; 
}

body:has(#dbg:checked) a:hover {
  outline: #fff5 solid 3px;
}

body:has(#dbg:checked) .hover-zone::after {
  opacity: var(--o, 0); 
  content: 'clicked';
}

/* update 09/21/25: added focus on tab */
/* ugly defines */
a {
  nav:has(:nth-child(01 of &):is(:hover,:focus-visible)) {--p: 01;}
  nav:has(:nth-child(02 of &):is(:hover,:focus-visible)) {--p: 02;}
  nav:has(:nth-child(03 of &):is(:hover,:focus-visible)) {--p: 03;}
  nav:has(:nth-child(04 of &):is(:hover,:focus-visible)) {--p: 04;}
  nav:has(:nth-child(05 of &):is(:hover,:focus-visible)) {--p: 05;}
  nav:has(:nth-child(06 of &):is(:hover,:focus-visible)) {--p: 06;}
  nav:has(:nth-child(07 of &):is(:hover,:focus-visible)) {--p: 07;}
  nav:has(:nth-child(08 of &):is(:hover,:focus-visible)) {--p: 08;}
  nav:has(:nth-child(09 of &):is(:hover,:focus-visible)) {--p: 09;}
  nav:has(:nth-child(10 of &):is(:hover,:focus-visible)) {--p: 10;}
  nav:has(:nth-child(11 of &):is(:hover,:focus-visible)) {--p: 11;}
  nav:has(:nth-child(12 of &):is(:hover,:focus-visible)) {--p: 12;}
  nav:has(:nth-child(13 of &):is(:hover,:focus-visible)) {--p: 13;}
  nav:has(:nth-child(14 of &):is(:hover,:focus-visible)) {--p: 14;}
}

i {
  nav:has(:nth-child(1 of &):hover) {--z: 1;}
  nav:has(:nth-child(2 of &):hover) {--z: 2;}
  nav:has(:nth-child(3 of &):hover) {--z: 3;}
  nav:has(:nth-child(4 of &):hover) {--z: 4;}
  nav:has(:nth-child(5 of &):hover) {--z: 5;}
  nav:has(:nth-child(6 of &):hover) {--z: 6;}
  nav:has(:nth-child(7 of &):hover) {--z: 7;}
  nav:has(:nth-child(8 of &):hover) {--z: 8;}
  nav:has(:nth-child(9 of &):hover) {--z: 9;}
}